version: 0.2

phases:
  install:
    commands:
      - echo Entered the install phase...
      - cd api/
      - npm install
      - cd ..
      - npm install
    finally:
      - echo This always runs even if the update or install command fails 
  build:
    commands:
      - echo Entered the build phase...
      - echo Build started on `date`
      - npm run build
    finally:
      - echo This always runs even if the install command fails
  post_build:
    commands:
      - echo Entered the post_build phase...
      - echo Build completed on `date`.
      - zip -r zap-spotify.zip build/ api/
      - ls -la
      - #aws s3 cp zap-spotify.zip s3://zap-spotify-resource-bucket/zap-spotify.zip
      - #pip3 install awscli --upgrade --user
      - #aws codeartifact login --tool npm --repository zap-spotify-build --domain stobo-industries --domain-owner 064156228657
      - #npm publish

artifacts:
  files:
    - zap-spotify.zip
    - appspec.yml
    - deployment.sh